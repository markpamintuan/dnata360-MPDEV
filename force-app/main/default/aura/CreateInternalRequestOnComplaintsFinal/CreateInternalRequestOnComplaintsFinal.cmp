<aura:component controller="Create_Internal_Req_And_Issues_New" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId"  access="global">
	<lightning:workspaceAPI aura:id="workspace" />
    <aura:attribute name="caseRecord" type="Case"/>
    <aura:attribute name="debug" type="boolean" default="false"/>
    <aura:attribute name="isLoading" type="boolean" default="false"/>      
    <aura:attribute name="isOpen" type="boolean" default="false"/>      
    <aura:attribute name="bookings" type="List" default="[]"/>  
    <aura:attribute name="columns" type="List"/>
    <aura:attribute name="casebookingList" type="List"/>
    <aura:attribute name="steps" type="List"/>
    <aura:attribute name="currentStep" type="string" default="1"/>
    <aura:attribute name="bookingValue" type="Object" />
    <aura:attribute name="data" type="Object" default="[]"/>
    <aura:attribute name="dataCurrent" type="Object" default="[]"/>
    <aura:attribute name="currentBooking" type="Integer" default="1"/>
    <aura:handler name="change" value="{!v.currentBooking}" action="{!c.accessArray}" />
    <aura:attribute name="currentInternalRequest" type="String" default=""/>
    <aura:attribute name="supplierlist" type="List" default=""/>
    <aura:attribute name="supplierlistissues" type="List" default=""/>
    
    <!--Internal Request Fields -->
    <aura:attribute name="Subject" type="String" default="" />
    <aura:attribute name="Responsible" type="String" default="" />
    <aura:attribute name="Status" type="String" default="" />
    <aura:attribute name="Owner" type="String" default="" />
    <aura:attribute name="Description" type="String" default="" />
    
    
    <!-- Owner Field -->
    <aura:attribute name="SearchKeyWord" type="string"/>
    <aura:attribute name="IconName" type="string" default="standard:user"/>
    <aura:attribute name="lookupSearchType" type="String[]" default="User,Queue"/>
    <aura:attribute name="selLookupType" type="String" default="User"/>
    <aura:attribute name="listOfSearchRecords" type="Object[]" description="Use,for store the list of search records which returns from apex class"/>
    <aura:attribute name="selectedRecord" type="Object" default="{}" description="Use,for store SELECTED sObject Record"/>
    <aura:handler name="oSelectedRecordEvent" event="c:selectedUserRecordEvent" action="{!c.handleComponentEvent}"/>
    
    
    <!-- Issue Fields -->
    <aura:attribute name="Issue__c" type="String" default="" />
    <aura:attribute name="Issue_Type__c" type="String" />
    <aura:attribute name="IssueSupplierName" type="String" default=''/>
    <aura:attribute name="IssueDescription" type="String" default="" />
    <aura:attribute name="YalagoProvider" type="String" default=""/> 
    
    
    <!-- Issues and Internal Request Temporary List -->
    <aura:attribute name="tempInternalList" type="List" default='[]'/>
    <aura:attribute name="tempIssueList" type="List" default='[]'/>
    
    
    
    <force:recordData aura:id="caseidrecord"                       
                      recordId="{!v.recordId}" 
                      targetError="{!v.recordError}"                       
                      fields="Id,Org_Booking__c,OwnerId,Org_Owner_Name__c"
                      targetFields="{!v.caseRecord}"                      
                      />
    <aura:if isTrue="{!v.isLoading}">
    		<lightning:spinner alternativeText="Loading" size="large" class="spinnertest" style="z-index:9999;position:fixed"/>
	</aura:if>
    <ui:button   
               class="slds-button slds-button--neutral"                        
               press="{!c.openModal}" disabled="{!v.caseRecord.Status == 'Closed' }">Add Issues</ui:button>
    
    <aura:if isTrue="{!v.isOpen}">
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">            
            <div class="slds-modal__container">               
                <div class="slds-modal__header">                   
                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Complaint Process </h2>
                </div>
                <div class="slds-modal__content slds-p-around_medium" style="max-height:75%;">  
                    <div class="{!v.currentStep == '1' ? 'slds-show' : 'slds-hide'}">
                        <h1 class="slds-card__header-title"><b>Please select the bookings you want to send this complaint to.</b></h1>
                        <br/>
                         <h2 class="slds-card__header-title">You will go through the steps of one booking first before proceeding to the next booking.</h2>
                        <br/>
                        <aura:iteration items="{!v.casebookingList}" var="cs" indexVar="iVar" end="{!v.end}">
                        	<article class="slds-card" style="background-color:#f3f2f2;padding-bottom:10px" aura:id="article">
                            <div class="slds-card__header slds-grid">
                                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                                     <ui:inputCheckBox aura:id="checkbox" class="checkbox" name="{!'checkbox-' + (iVar+1)}" label="" text="{!cs.Name}"  change="{!c.onCheck}"/>&nbsp;&nbsp;
                                    <aura:if isTrue="{!cs.Org_Booking_Type__c == 'Flight'}">
                                        <aura:if isTrue="{!cs.Id == v.caseRecord.Org_Booking__c}">
                                            <span class="slds-badge currentBadge" data-aura-rendered-by="12960:0">current</span>
                                        </aura:if>
                                        <img src="{!$Resource.Icon_Flight}"/>
                                    </aura:if> 
                                    <aura:if isTrue="{!cs.Org_Booking_Type__c == 'Accommodation'}">
                                        <aura:if isTrue="{!cs.Id == v.caseRecord.Org_Booking__c}">
                                            <span class="slds-badge currentBadge" data-aura-rendered-by="12960:0">current</span>
                                        </aura:if>
                                        <img src="{!$Resource.Icon_Hotel}"/>
                                    </aura:if> 
                                    <aura:if isTrue="{!cs.Org_Booking_Type__c == 'Transfer'}">
                                        <aura:if isTrue="{!cs.Id == v.caseRecord.Org_Booking__c}">
                                            <span class="slds-badge currentBadge" data-aura-rendered-by="12960:0">current</span>
                                        </aura:if>
                                        <img src="{!$Resource.Icon_Transfer}"/>
                                    </aura:if>
                                    <aura:if isTrue="{!cs.Org_Booking_Type__c == 'Travel Insurance'}">
                                        <aura:if isTrue="{!cs.Id == v.caseRecord.Org_Booking__c}">
                                            <span class="slds-badge currentBadge" data-aura-rendered-by="12960:0">current</span>
                                        </aura:if>
                                        <img src="{!$Resource.Icon_Insurance}"/>
                                    </aura:if>
                                    <aura:if isTrue="{!cs.Org_Booking_Type__c == 'Marhaba'}">
                                        <aura:if isTrue="{!cs.Id == v.caseRecord.Org_Booking__c}">
                                            <span class="slds-badge currentBadge" data-aura-rendered-by="12960:0">current</span>
                                        </aura:if>
                                        <img src="{!$Resource.Icon_Marhaba}"/>
                                    </aura:if> 
                                     <aura:if isTrue="{!cs.Org_Booking_Type__c == 'Airport Parking'}">
                                            <img src="{!$Resource.Icon_Parking	}" height="20px" style="height:24px"/>
                                            <aura:if isTrue="{!cs.Id == v.caseRecord.Org_Booking__c}">
                                               <span class="slds-badge currentBadge" data-aura-rendered-by="12960:0">current</span>
                                        </aura:if>
                                        </aura:if>
                                    <div class="slds-media__body">
                                        
                                        <h2 class="slds-card__header-title">
                                           
                                            <a href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="Accounts">
                                                <span>&nbsp;{!cs.Name}</span>
                                            </a>
                                        </h2>
                                    </div>
                                    
                                </header>
                            </div>
                            <div class="slds-card__body slds-card__body_inner">
                                <div class="slds-grid slds-wrap">
                                    
                                    <div style="padding-left: 9px" class="slds-size_1-of-2">Title :
                                    {!cs.Org_Title__c}
                                    </div>
                                    <div style="padding-left: 9px" class="slds-size_1-of-2">Booking Type :
                                    {!cs.Org_Booking_Type__c}
                                    </div>
                                    <div style="padding-left: 9px" class="slds-size_1-of-2">Booked Status :
                                    {!cs.Booking_Status__c}
                                    </div>
                                    <div style="padding-left: 9px" class="slds-size_1-of-2">Booked Date :
                                      <lightning:formattedDateTime value="{!cs.Org_Booked_Date__c}" />
                                   
                                    </div>
                                    <div style="padding-left: 9px" class="slds-size_1-of-2">Travel Start Date :
                                        <lightning:formattedDateTime value="{!cs.Org_Travel_Start_Date__c}" />
                                    </div>
                                    <div style="padding-left: 9px" class="slds-size_1-of-2">Travel End Date :
                                    
                                        <lightning:formattedDateTime value="{!cs.Org_Travel_End_Date__c}" />
                                    
                                    </div>
                                    
                                </div>
                                
                            </div>
                            
                        </article>
                        </aura:iteration>
                         </div>    
                    <div class="{!v.currentStep == '2' ? 'slds-show' : 'slds-hide'}">
                    	<div class="section">
                            <div class="slds-grid slds-gutters">                                
                                   <div class="slds-vertical-tabs" style="width:-webkit-fill-available">
                                    <ul class="slds-vertical-tabs__nav" role="tablist" aria-orientation="vertical">
                                        <aura:iteration items="{!v.bookings}" var="step" indexVar="index">
                                        <li class="{! step.selected ? 'slds-vertical-tabs__nav-item slds-is-active':'slds-vertical-tabs__nav-item'}" title="Tab 1" role="presentation">
                                            <a class="slds-vertical-tabs__link" data-index="{!index}" aura:id="menuItem" role="tab" tabindex="0" aria-selected="true" aria-controls="slds-vertical-tabs-0" id="slds-vertical-tabs-0__nav">                                                                                       
                                                <span class="slds-vertical-tabs__left-icon"></span>
                                                <span class="slds-truncate" title="Tab 1"><aura:if isTrue="{!step.Org_Booking_Type__c == 'Flight'}">                                     
                                                        <img src="{!$Resource.Icon_Flight}"/>
                                                    </aura:if> 
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Accommodation'}">                                                        
                                                        <img src="{!$Resource.Icon_Hotel}"/>
                                                    </aura:if> 
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Transfer'}">     
                                                        <img src="{!$Resource.Icon_Transfer}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Travel Insurance'}">                                                        
                                                        <img src="{!$Resource.Icon_Insurance}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Marhaba'}">                                                        
                                                        <img src="{!$Resource.Icon_Marhaba}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Airport Parking'}">                                                        
                                                        <img src="{!$Resource.Icon_Parking}" height="24px !important" style="height:24px"/>
                                                    </aura:if> 
                                                    &nbsp;{!step.Name}</span>
                                                <span class="slds-vertical-tabs__right-icon"></span>
                                            </a>
                                        </li>
                                        </aura:iteration>
                                    </ul>
                                    <div class="slds-vertical-tabs__content slds-show" id="slds-vertical-tabs-0" role="tabpanel" aria-labelledby="slds-vertical-tabs-0__nav">
                                        <div class="slds-text-longform">                                          
                                                <div class="slds-col slds-size_11-of-12"><h3 style="font-size:18px"><b>Select Internal Request for {!v.bookingValue.Name}</b></h3></div>
                                                <br/>
                                            
                                                <aura:iteration items="{!v.data}" var="cs" indexVar="iVar" end="{!v.end}">
                                                    <article class="slds-card" style="background-color:#f3f2f2;padding-bottom:10px" aura:id="article">
                                                    <div class="slds-card__header slds-grid">
                                                        <header class="slds-media slds-media_center slds-has-flexi-truncate">
                                                            <ui:inputRadio  aura:id="radiobox" class="radiobox" name="radiobuttongroup" label="" text="{!cs.Id}"  change="{!c.onCheckHeader}"/>&nbsp;&nbsp;
                                                            
                                                            <div class="slds-media__body">
                                                                
                                                                <h2 class="slds-card__header-title">
                                                                   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                    <a href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="Accounts">
                                                                        <span>{!cs.CaseNumber}</span>
                                                                        
                                                                    </a>
                                                                    
                                                                </h2>
                                                                <aura:renderIf isTrue="{!(cs.Id != 'New')}">
                                                                	<div class="slds-card__body slds-card__body_inner">
                                                                        <div class="slds-grid slds-wrap">                                                                       
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-2">Subject :
                                                                            	{!cs.Subject}
                                                                            </div>
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-2">Responsible :
                                                                            	{!cs.End_Provider_Name__c}
                                                                            </div>
                                                                            <aura:if isTrue="{!cs.End_Provider_Name__c == 'Yalago'}">
                                                                                <div style="padding-left: 9px" class="slds-size_1-of-2">Yalago Provider :
                                                                                    {!cs.Yalago_Provider__c}
                                                                                </div>
                                                                            </aura:if>    
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-2">Status :
                                                                            	{!cs.Org_Case_Status__c}
                                                                            </div>
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-2">Owner :
                                                                            	{!cs.Owner_Name__c} 
                                                                            </div>
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-1">Description :
                                                                            	{!cs.Description} 
                                                                            </div>
                                                                           
                                                                        </div>
                                                                    <br/><b> Issues: </b><br/>
                                                                        
                                                                        <c:IssuePillContainer recordId="{!cs.Id}" aura:id="cComp" displayCross="none"/>
                                                                </div>
                                                                </aura:renderIf>
                                                            </div>
                                                            
                                                        </header>
                                                    </div>
                                                    
                                                </article>
                                                </aura:iteration>                                                                            
                                        </div>                                           
                                     </div>
                                </div>
                            </div>
                         </div>
                            	
                                   
                         
                            </div>
                    <div class="{!v.currentStep == '3' ? 'slds-show' : 'slds-hide'}">
                    	<div class="section">
                            <div class="slds-grid slds-gutters">                                
                                   <div class="slds-vertical-tabs">
                                    <ul class="slds-vertical-tabs__nav" role="tablist" aria-orientation="vertical">
                                        <aura:iteration items="{!v.bookings}" var="step" indexVar="index">
                                        <li class="{! step.selected ? 'slds-vertical-tabs__nav-item slds-is-active':'slds-vertical-tabs__nav-item'}" title="Tab 1" role="presentation">
                                            <a class="slds-vertical-tabs__link" data-index="{!index}" aura:id="menuItem" role="tab" tabindex="0" aria-selected="true" aria-controls="slds-vertical-tabs-0" id="slds-vertical-tabs-0__nav">                                                                                       
                                                <span class="slds-vertical-tabs__left-icon"></span>
                                                <span class="slds-truncate" title="Tab 1"><aura:if isTrue="{!step.Org_Booking_Type__c == 'Flight'}">                                     
                                                        <img src="{!$Resource.Icon_Flight}"/>
                                                    </aura:if> 
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Accommodation'}">                                                        
                                                        <img src="{!$Resource.Icon_Hotel}"/>
                                                    </aura:if> 
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Transfer'}">     
                                                        <img src="{!$Resource.Icon_Transfer}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Travel Insurance'}">                                                        
                                                        <img src="{!$Resource.Icon_Insurance}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Marhaba'}">                                                        
                                                        <img src="{!$Resource.Icon_Marhaba}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Airport Parking'}">                                                        
                                                        <img src="{!$Resource.Icon_Parking}" height="24px !important" style="height:24px"/>
                                                    </aura:if> 
                                                    &nbsp;{!step.Name}</span>
                                                <span class="slds-vertical-tabs__right-icon"></span>
                                            </a>
                                        </li>
                                        </aura:iteration>
                                    </ul>
                                    <div class="slds-vertical-tabs__content slds-show" id="slds-vertical-tabs-0" role="tabpanel" aria-labelledby="slds-vertical-tabs-0__nav">
                                        <div class="slds-text-longform">                                          
                                                <div class="slds-col slds-size_11-of-12"><h3 style="font-size:18px"><b>Add Internal Request for {!v.bookingValue.Name}</b></h3></div>
                                            	
                                                <br/>
                                                <div style="width:-webkit-fill-available">
                                                    <lightning:recordEditForm objectApiName="Case" >                                                         
                                                              <div class="slds-col slds-size_1-of-2" style="display:inline-block" ><lightning:inputField aura:id="subject" label="Subject"
                                                                                                                                                       name="Subject"
                                                                                                                                                       value="{!v.Subject}"
                                                                                                                                                       fieldName="Subject"                          
                                                                                                                                                       required="true"/> </div>
                                                             <div class="slds-col slds-size_1-of-2" style="display:inline-block" ><span class="required ">*</span>
                                                             
                                                             		<lightning:combobox aura:id="endprovidername" name="EndProviderName" label="Responsible" placeholder="Select Provider Name" value="{!v.Responsible}"
                        																options="{! v.supplierlist }" disabled="{!empty(v.supplierlist)}" />
                                                             </div>
                                                         <aura:if isTrue="{!v.Responsible == 'Yalago'}">
                                                            <div class="slds-col slds-size_1-of-2" style="display:inline-block" >
                                                                 <lightning:inputField aura:id="yalagoprovider" label="Yalago Provider"
                                                                                                                                                           name="YalagoProvider"
                                                                                                                                                           value="{!v.YalagoProvider}"
                                                                                                                                                           fieldName="Yalago_Provider__c"                                                                                                                           
                                                                                                                                                           required="true"/> 
                                                                        
                                                                 </div>
                                                                </aura:if>
                                                             <div class="slds-col slds-size_1-of-2" style="display:inline-block" ><lightning:inputField aura:id="status" label="Status"
                                                                                                                                                       name="Status"
                                                                                                                                                       value="{!v.Status}"
                                                                                                                                                       fieldName="Org_Case_Status__c"                                                                                                                           
                                                                                                                                                       required="true"/> </div>
                                                        <div class="slds-col slds-size_1-of-2" style="display:inline-block">
                                                        		  <div class="lookuptypeselect">
                                                                   <ui:inputSelect aura:id="lkptype" label="Assign Owner" change="{!c.onSelectChange}"  required = "true"  >
                                                                                        <aura:iteration items="{!v.lookupSearchType}" var="ltype">
                                                                                            <ui:inputSelectOption text="{!ltype}" label="{!ltype}" />
                                                                                        </aura:iteration>
                                                                                    </ui:inputSelect>
                                                                  </div>               
                                                                  <div onmouseleave="{!c.onblur}" aura:id="searchRes" class="slds-form-element slds-lookup slds-is-close" data-select="single" style="width:74%;display:inline-block;margin-left:1%">
                                                                    <label class="slds-form-element__label" for="lookup-348">{!v.label}</label>
                                                                    
                                                                    <div class="slds-form-element__control">
                                                                        
                                                                        <div class="slds-input-has-icon slds-input-has-icon--right">
                                                                            <lightning:icon class="slds-input__icon slds-show" iconName="utility:search" size="x-small" alternativeText="search"/> 
                                                                            
                                                                            <div aura:id="lookup-pill" class="slds-pill-container slds-hide">
                                                                                <lightning:pill class="pillSize" label="{!v.selectedRecord.rname}" name="{!v.selectedRecord.rname}" onremove="{! c.clear }">
                                                                                    <aura:set attribute="media">
                                                                                        <lightning:icon  iconName="{!v.IconName}" size="x-small" alternativeText="{!v.IconName}"/>
                                                                                    </aura:set>
                                                                                </lightning:pill>
                                                                            </div>
                                                                            <div aura:id="lookupField" class="slds-show">
                                                                              <span class="slds-icon_container  slds-combobox__input-entity-icon" title="record">
                                                                                <lightning:icon class="slds-icon slds-icon slds-icon_small slds-icon-text-default" iconName="{!v.IconName}" size="x-small" alternativeText="icon"/>
                                                                                <span class="slds-assistive-text"></span>
                                                                            </span>
                                                                                <ui:inputText   aura:id = "caseOwner" updateOn="keyup" keyup="{!c.keyPressController}" class="slds-lookup__search-input slds-input leftPaddingClass" value="{!v.SearchKeyWord}" placeholder="search.."/>
                                                                                <div class="slds-notify slds-notify_toast slds-theme_error"> 
                                                                                    <div class="slds-notify__content">
                                                                                        <p class="slds-align_absolute-center">{!v.errorMessage}</p>                
                                                                                    </div>
                                                                                </div>
                                                                            </div>   
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <ul style="min-height:40px;max-height:250px;overflow-x:hidden;overflow-y:auto;margin-top:0px !important" class="slds-listbox slds-listbox_vertical slds-dropdown slds-dropdown_fluid slds-lookup__menu slds" role="listbox">
                                                                        <lightning:spinner class="slds-hide" variant="brand" size="small" aura:id="mySpinner"/>
                                                                        <center> {!v.Message}</center>
                                                                        <aura:iteration items="{!v.listOfSearchRecords}" var="singleRec">
                                                                            <c:customUserLookupResult oRecord="{!singleRec}" IconName="{!v.IconName}"/>
                                                                        </aura:iteration>
                                                                    </ul>
                                                                </div>                                                                                              
                                                        </div>
                                                        <div class="slds-col slds-size_1-of-1" style="display:inline-block" ><lightning:inputField aura:id="description" label="Description"
                                                                                                                                                       name="Description"
                                                                                                                                                       value="{!v.Description}"
                                                                                                                                                       fieldName="Description"                                                                                                                           
                                                                                                                                                       required="true"/> </div>
                                                             
                                                             
                                                             
                                                        
													</lightning:recordEditForm> 
                                                </div>
                                                
                                               
                                               
                                                    </div>                                           
                                        </div>
                                    </div>
                                </div>
                            </div>
                            	
                                   
                         
                            </div>
                    <div class="{!v.currentStep == '4' ? 'slds-show' : 'slds-hide'}">
                    	<div class="section">
                            <div class="slds-grid slds-gutters">
                                
                                   <div class="slds-vertical-tabs">
                                    <ul class="slds-vertical-tabs__nav" role="tablist" aria-orientation="vertical">
                                        <aura:iteration items="{!v.bookings}" var="step" indexVar="index">
                                        <li class="{! step.selected ? 'slds-vertical-tabs__nav-item slds-is-active':'slds-vertical-tabs__nav-item'}" title="Tab 1" role="presentation">
                                            <a class="slds-vertical-tabs__link" data-index="{!index}" aura:id="menuItem" role="tab" tabindex="0" aria-selected="true" aria-controls="slds-vertical-tabs-0" id="slds-vertical-tabs-0__nav">
                                                <!-- onclick="{!c.setIndex}" -->
                                                
                                                <span class="slds-vertical-tabs__left-icon"></span>
                                                <span class="slds-truncate" title="Tab 1"><aura:if isTrue="{!step.Org_Booking_Type__c == 'Flight'}">
                                       
                                                        <img src="{!$Resource.Icon_Flight}"/>
                                                    </aura:if> 
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Accommodation'}">
                                                        
                                                        <img src="{!$Resource.Icon_Hotel}"/>
                                                    </aura:if> 
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Transfer'}">
                                                        
                                                        <img src="{!$Resource.Icon_Transfer}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Travel Insurance'}">
                                                        
                                                        <img src="{!$Resource.Icon_Insurance}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Marhaba'}">
                                                        
                                                        <img src="{!$Resource.Icon_Marhaba}"/>
                                                    </aura:if>
                                                    <aura:if isTrue="{!step.Org_Booking_Type__c == 'Airport Parking'}">
                                                        
                                                        <img src="{!$Resource.Icon_Parking}" height="24px !important" style="height:24px"/>
                                                    </aura:if> 
                                                    &nbsp;{!step.Name}</span>
                                                <span class="slds-vertical-tabs__right-icon"></span>
                                            </a>
                                        </li>
                                        </aura:iteration>
                                    </ul>
                                    <div class="slds-vertical-tabs__content slds-show" id="slds-vertical-tabs-0" role="tabpanel" aria-labelledby="slds-vertical-tabs-0__nav">
                                        <div class="slds-text-longform">
                                            
                                                <div class="slds-col slds-size_11-of-12"><h3 style="font-size:16px"><b>Add Issues for {!v.bookingValue.Name}</b></h3></div>                                                
                                                
                                                <div style="width:-webkit-fill-available">
                                                   <article class="slds-card" style="background-color:#f3f2f2;padding-bottom:10px" aura:id="article_r">
                                                       <div class="slds-card__header slds-grid">
                                                           <b>Current Internal Request</b>
                                                       </div>
                                                       <div class="slds-card__body slds-card__body_inner">
                                                           <div class="slds-grid slds-wrap">                                                                       
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-2"><b>Subject</b> :
                                                                            	{!v.Subject}
                                                                            </div>
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-2"><b>Responsible</b> :
                                                                            	{!v.Responsible}
                                                                            </div>
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-2"><b>Status</b> :
                                                                            	{!v.Status}
                                                                            </div>
                                                                            <div style="padding-left: 9px" class="slds-size_1-of-2"><b>Owner</b> :
                                                                            	{!v.selectedRecord.rname} 
                                                                            </div>
                                                               				<div style="padding-left: 9px" class="slds-size_1-of-1"><b>Description</b> :
                                                                            	{!v.Description} 
                                                                            </div>
                                                                           
                                                                        </div>
                                                       </div>
                                                    </article>
                                                </div>
                                            <br/>
                                                    <div style="width:-webkit-fill-available">
                                                        <lightning:recordEditForm objectApiName="Issues__c" >
                                                             
                                                                  <div class="slds-col slds-size_1-of-3" style="display:inline-block" ><lightning:inputField aura:id="issue" label="Issue"
                                                                                                                                                           name="Issue"
                                                                                                                                                           value="{!v.Issue__c}"
                                                                                                                                                           fieldName="Issue__c"                          
                                                                                                                                                           required="true"/> </div>
                                                                 <div class="slds-col slds-size_1-of-3" style="display:inline-block" ><lightning:inputField aura:id="issuetype" label="Issue Type"
                                                                                                                                                           name="IssueType"
                                                                                                                                                           value="{!v.Issue_Type__c}"
                                                                                                                                                           fieldName="Issue_Type__c"                                                                                                                           
                                                                                                                                                           required="true"/> </div>
                                                                 
                                                                 <div class="slds-col slds-size_1-of-3" style="display:inline-block" ><span class="required ">*</span>
                                                                 
                                                                        <lightning:combobox  name="EndProviderName" label="End Provider Name" value="{!v.IssueSupplierName}" placeholder="Select Provider Name" 
                                                                                            options="{! v.supplierlistissues }" disabled="{!empty(v.supplierlistissues)}" />
                                                                 </div>
                                                           
                                                            <div class="slds-col slds-size_3-of-4" style="display:inline-block" ><lightning:inputField aura:id="issuedescription" label="Description"
                                                                                                                                                           name="IssueDescription"
                                                                                                                                                           value="{!v.IssueDescription}"
                                                                                                                                                           fieldName="Description__c"                                                                                                                           
                                                                                                                                                           required="true"/> </div>
                                                                  
                                                            	 <div class="slds-col slds-size_1-of-4" style="display:inline-block" >
                                                                 		<div class="slds-col slds-size_1-of-3" style="display:inline-block" >
                                                                 			<lightning:button variant="brand" 
                                                                                  label="Add"
                                                                                  title="Add"
                                                                                  class="addissuebutton"
                                                                                  onclick="{!c.addIssue}" disabled="{!v.Issue__c == '' || v.Issue_Type__c == '' || v.IssueSupplierName =='' || v.IssueDescription == ''}" />
                                                                 		</div>
                                                                     	
                                                                       
                                                                 </div>
                                                                 
                                                            
                                                        </lightning:recordEditForm>
                                                    </div>
                                                
                                                <br/>
                                                <aura:if isTrue="{!v.currentInternalRequest != ''}">
                                                    <h3 style="font-size:14px;padding-left:1%"><b>Current Issues</b></h3>
                                                    <aura:renderIf isTrue="{!v.currentStep == '4'}">
                                                		<c:IssuePillContainer recordId="{!v.currentInternalRequest}" aura:id="cComp2" displayCross="block" />
                                                    </aura:renderIf>
                                                </aura:if>
                                                <div class="slds-col"></div>
                                               
                                                    </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                            	
                                   
                         
                            </div>
                    
                   
                </div>
                <div class="slds-modal__footer slds-modal__footer_directional">
                    <lightning:button 
                                      variant="neutral" 
                                      label="Cancel"
                                      title="Cancel"
                                      onclick="{! c.closeModal }"/>
                    
                    <lightning:button disabled="{!(v.currentStep != '3' &amp;&amp; v.currentStep != '4')}"
                                      variant="neutral" 
                                      label="Back"
                                      title="Back"
                                      onclick="{! c.moveBack }"/>
                    <aura:renderif isTrue="{!v.currentStep != '4'}">
                        <lightning:button variant="brand" 
                                                  label="Next"
                                                  title="Next"
                                        	      onclick="{! c.moveNext }" disabled="{!(empty(v.bookings) &amp;&amp; v.currentStep == '1')||(v.currentStep == '2' &amp;&amp; v.currentInternalRequest == '')||(v.currentStep == '3' &amp;&amp; ((v.Subject == ''|| v.Subject == null) || (v.Responsible == ''||v.Responsible == null) || ( v.Status == ''|| v.Status == null) || (v.Description == ''||v.Description == null)))}"/>
                     </aura:renderif> 
                    <aura:renderif isTrue="{!v.currentStep == '4'}">
                        <lightning:button variant="brand" 
                                                  label="Save and New"
                                                  title="Save and New"
                                        	      onclick="{! c.moveNextandNew }"/>
                        <aura:renderif isTrue="{!(v.bookings.length != v.currentBooking)}">
                            <lightning:button variant="brand" 
                                                      label="Save and move to next Booking"
                                                      title="Save and move to next Booking"
                                                      onclick="{!c.moveNextandNextBooking }"/>
                            <aura:set attribute="else">
 								<lightning:button variant="brand" 
                                                      label="Finish"
                                                      title="Finish"
                                                      onclick="{! c.closeModal }"/>
                            </aura:set>
                            </aura:renderif>
                     </aura:renderif> 
                </div>
                <footer class="slds-modal__footer">
                    
                    <lightning:progressIndicator currentStep="{!v.currentStep}" type="base">   
                        
                        <lightning:progressStep label="Select Booking Items" value="1" />
                        <lightning:progressStep label="Select New/Existing Internal Request" value="2" />                       
                        <lightning:progressStep label="Add/Edit Internal Request" value="3"/>
                        <lightning:progressStep label="Add/Edit Issues" value="4"/>
                        
                    </lightning:progressIndicator>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>
</aura:component>