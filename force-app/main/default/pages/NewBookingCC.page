<apex:page showHeader="true" sidebar="false" standardController="Case" extensions="NewBookingExtCC"
           lightningstylesheets="true" id="mainPage" docType="html-5.0" standardStylesheets="true">
    <apex:slds />
    
    <c:Dnata_CSS />
    
    
    
    <style>
        
        
        .bookingpage.container {
        width: 100% !important;
        margin: auto !important;
        //margin-top: 0.5em !important;
        }
        
        .sk-circle {
        margin: 100px auto; 
        width: 80px;
        height: 80px;
        position: relative;
        }
        .sk-circle .sk-child {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        }
        .sk-circle .sk-child:before {
        content: '';
        display: block;
        margin: 0 auto;
        width: 15%;
        height: 15%;
        background-color: white;
        border-radius: 100%;
        -webkit-animation: sk-circleBounceDelay 1.2s infinite ease-in-out both;
        animation: sk-circleBounceDelay 1.2s infinite ease-in-out both;
        }
        .sk-circle .sk-circle2 {
        -webkit-transform: rotate(30deg);
        -ms-transform: rotate(30deg);
        transform: rotate(30deg); }
        .sk-circle .sk-circle3 {
        -webkit-transform: rotate(60deg);
        -ms-transform: rotate(60deg);
        transform: rotate(60deg); }
        .sk-circle .sk-circle4 {
        -webkit-transform: rotate(90deg);
        -ms-transform: rotate(90deg);
        transform: rotate(90deg); }
        .sk-circle .sk-circle5 {
        -webkit-transform: rotate(120deg);
        -ms-transform: rotate(120deg);
        transform: rotate(120deg); }
        .sk-circle .sk-circle6 {
        -webkit-transform: rotate(150deg);
        -ms-transform: rotate(150deg);
        transform: rotate(150deg); }
        .sk-circle .sk-circle7 {
        -webkit-transform: rotate(180deg);
        -ms-transform: rotate(180deg);
        transform: rotate(180deg); }
        .sk-circle .sk-circle8 {
        -webkit-transform: rotate(210deg);
        -ms-transform: rotate(210deg);
        transform: rotate(210deg); }
        .sk-circle .sk-circle9 {
        -webkit-transform: rotate(240deg);
        -ms-transform: rotate(240deg);
        transform: rotate(240deg); }
        .sk-circle .sk-circle10 {
        -webkit-transform: rotate(270deg);
        -ms-transform: rotate(270deg);
        transform: rotate(270deg); }
        .sk-circle .sk-circle11 {
        -webkit-transform: rotate(300deg);
        -ms-transform: rotate(300deg);
        transform: rotate(300deg); }
        .sk-circle .sk-circle12 {
        -webkit-transform: rotate(330deg);
        -ms-transform: rotate(330deg);
        transform: rotate(330deg); }
        .sk-circle .sk-circle2:before {
        -webkit-animation-delay: -1.1s;
        animation-delay: -1.1s; }
        .sk-circle .sk-circle3:before {
        -webkit-animation-delay: -1s;
        animation-delay: -1s; }
        .sk-circle .sk-circle4:before {
        -webkit-animation-delay: -0.9s;
        animation-delay: -0.9s; }
        .sk-circle .sk-circle5:before {
        -webkit-animation-delay: -0.8s;
        animation-delay: -0.8s; }
        .sk-circle .sk-circle6:before {
        -webkit-animation-delay: -0.7s;
        animation-delay: -0.7s; }
        .sk-circle .sk-circle7:before {
        -webkit-animation-delay: -0.6s;
        animation-delay: -0.6s; }
        .sk-circle .sk-circle8:before {
        -webkit-animation-delay: -0.5s;
        animation-delay: -0.5s; }
        .sk-circle .sk-circle9:before {
        -webkit-animation-delay: -0.4s;
        animation-delay: -0.4s; }
        .sk-circle .sk-circle10:before {
        -webkit-animation-delay: -0.3s;
        animation-delay: -0.3s; }
        .sk-circle .sk-circle11:before {
        -webkit-animation-delay: -0.2s;
        animation-delay: -0.2s; }
        .sk-circle .sk-circle12:before {
        -webkit-animation-delay: -0.1s;
        animation-delay: -0.1s; }
        
        @-webkit-keyframes sk-circleBounceDelay {
        0%, 80%, 100% {
        -webkit-transform: scale(0);
        transform: scale(0);
        } 40% {
        -webkit-transform: scale(1);
        transform: scale(1);
        }
        }
        
        @keyframes sk-circleBounceDelay {
        0%, 80%, 100% {
        -webkit-transform: scale(0);
        transform: scale(0);
        } 40% {
        -webkit-transform: scale(1);
        transform: scale(1);
        }
        }
        
        
        html {
        overflow-x: hidden;
        }
        
        .liItem:hover {
        cursor: pointer !important;
        background-color: #d4d4d4 !important;
        }
        
        li {
        padding-left: 12px !important;
        }
        
        select::-ms-expand {
        background-color: transparent;
        border-color: transparent;
        }
        
        .bookingpage .padding-3 {
        padding: 0px 3% 5% 3%!important;
        }
        
        .cmdLink {
        font-size: 89%;
        text-decoration: none;
        float: left;
        }
        
        .cmdLink:hover {
        text-decoration: underline;
        }
        
        
        
        body .lookupInput input[type="text"], .slds-vf-scope .lookupInput input[type="text"] {
        border: 1px solid rgb(221, 219, 218);
        max-width: 100%;
        border-radius: .25rem;
        background-color: rgb(255, 255, 255);
        color: rgb(8, 7, 7);
        -webkit-transition: border .1s linear,background-color .1s linear;
        transition: border .1s linear,background-color .1s linear;
        display: inline-block;
        padding: 0 1rem 0 .75rem;
        min-height: calc(1.875rem + (1px * 2));
        line-height: 1.875rem;
        width: 130px;
        }
        .bookingpage table {
        border: 1px !important;
        }
        
        .slds-scope .slds-table_bordered tbody td, .slds-scope .slds-table_bordered tbody th, .slds-scope .slds-table--bordered tbody td, .slds-scope .slds-table--bordered tbody th {
        border-top: none;
        }
        
        
        .slds-scope .slds-table_bordered:not(.slds-no-row-hover) tbody tr:hover>td:not(.slds-has-focus), .slds-scope .slds-table_bordered:not(.slds-no-row-hover) tbody tr:hover>th:not(.slds-has-focus), .slds-scope .slds-table_bordered:not(.slds-no-row-hover) tbody tr:focus>td:not(.slds-has-focus), .slds-scope .slds-table_bordered:not(.slds-no-row-hover) tbody tr:focus>th:not(.slds-has-focus), .slds-scope .slds-table--bordered:not(.slds-no-row-hover) tbody tr:hover>td:not(.slds-has-focus), .slds-scope .slds-table--bordered:not(.slds-no-row-hover) tbody tr:hover>th:not(.slds-has-focus), .slds-scope .slds-table--bordered:not(.slds-no-row-hover) tbody tr:focus>td:not(.slds-has-focus), .slds-scope .slds-table--bordered:not(.slds-no-row-hover) tbody tr:focus>th:not(.slds-has-focus) {
        box-shadow: transparent 0 -1px 0 inset, transparent 0 1px 0 inset;
        }
        
        .slds-scope .slds-table:not(.slds-no-row-hover) tbody tr:hover>td, .slds-scope .slds-table:not(.slds-no-row-hover) tbody tr:hover>th, .slds-scope .slds-table:not(.slds-no-row-hover) tbody tr:focus>td, .slds-scope .slds-table:not(.slds-no-row-hover) tbody tr:focus>th {
        /* background-color: transparent; */
        } 
        
        
        
        .slds-scope .slds-table_cell-buffer tr>th:last-child, .slds-scope .slds-table_cell-buffer tr>td:last-child, .slds-scope .slds-table--cell-buffer tr>th:last-child, .slds-scope .slds-table--cell-buffer tr>td:last-child {
        padding-left: 0;
        padding-right: 0;
        }
        
        .bookingpage .dateFormat, .demo-only .dateFormat {
        display: none !important;
        position: absolute;
        top: 0px;
        right: 0px;
        }
        
        body .lookupInput .lookupIconOn, body .lookupInput .lookupIcon, .slds-vf-scope .lookupInput .lookupIconOn, .slds-vf-scope .lookupInput .lookupIcon {
        
        top: 1rem;
        
        }
        
        .slds-scope .slds-dropdown {
        position: relative;   
        }
        
    </style>
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"/>
        
        <script>
        var noscroll_var = false;
    
    function noscroll() {
        if (noscroll_var) {
            document.getElementsByTagName("html")[0].style.overflowY = "";
            document.body.style.paddingRight = "0";
            noscroll_var = false
        } else {
            document.getElementsByTagName("html")[0].setAttribute('style',
                                                                  'overflow-y: hidden !important');
            document.body.style.paddingRight = "17px";
            noscroll_var = true;
        }
    }
    
    
    
    
    
    
    
    function deletePaymentConfirm(paymentId) {
        if (confirm("Are you sure to delete this payment information?")) {
            deletePayment(paymentId);
        }
    }
    
    $('body').css('background-color', '#fafaf9');
    
    
    
    
    
    
    
    function openModal(modalId) {
        console.log(modalId); 
        //window.scrollTo(0, document.getElementById(modalId+'qr').getBoundingClientRect().y);
        $('#' + modalId).addClass('slds-slide-up-saving');
        $('.slds-backdrop').addClass('slds-backdrop_open');
        noscroll();
    }
    
    function removeModal() {
        $('.slds-modal').removeClass('slds-slide-up-saving');
        $('.slds-backdrop').removeClass('slds-backdrop_open'); 
        noscroll();
        //RenderPbContainer();
    }
    
    
    function openModalAtt() {
        $('#attachmentModal').addClass('slds-slide-up-saving');
        $('#attachmentModalBackdrop').addClass('slds-backdrop_open');
        //window.scrollTo(0, document.getElementById(modalId+'qr').getBoundingClientRect().y);
        //var element = document.getElementById("attachmentModal");
        //var element2 = document.getElementById("attachmentModalBackdrop");
        //element.classList.add("slds-slide-up-saving");
        //element2.classList.add("slds-backdrop_open");
        noscroll();
    }
    function removeModalAtt() {
        //$('#mainPage:attachmentModalForm').removeAttr("action");
        //$('#attachmentModal').removeClass('slds-slide-up-saving');
        //$('#attachmentModalBackdrop').removeClass('slds-backdrop_open');
        //document.getElementById("mainPage:attachmentModalForm").addEventListener("click", function(event){
        //event.preventDefault()
        //$('#attachmentModalForm').attr('action', parent.document.URL);
        //});
        //console.log(parent.document.URL);
        
        //document.getElementById("mainPage:attachmentModalForm").action(parent.document.URL);
        var element = document.getElementById("attachmentModal");
        var element2 = document.getElementById("attachmentModalBackdrop");
        element.classList.remove("slds-slide-up-saving");
        element2.classList.remove("slds-backdrop_open");
        noscroll();
        //uploadFile();
        //RenderPbContainer();
    }
    
    
    
    
    
    function renderTraveller(tdTask, tdButton, tdSize) {
        var tdButtonVar = document.getElementById(tdButton);
        var tdElemVar = document.getElementById(tdTask);
        if (tdElemVar.style.display == "none") {
            tdElemVar.style.display = "";
        } else {
            tdElemVar.style.display = "none";
            RenderPbContainer();
        }
    }
    
    
    function productEval(pId, pUnique, pField) {
        if(pField == 'Product__c'){
            checkProductBrand(document.getElementById(pId + '_lkid').value,pUnique);  
            
            //alert(checkProductBrand(document.getElementById(pId + '_lkid').value,pUnique));
            setTimeout(function(){ renderTraveller(pUnique,'',''); }, 2000);            
        }
        if(pField == 'Quantity__c'){
            //checkProductBrand('',''); 
            //RenderPbContainer();
        }
        if(pField == 'Unit_Price__c'){
            //checkProductBrand('',''); 
            //RenderPbContainer();
        }
        
        
    }
    
    function getRemoteFlightsFrom(elemVar,uniqueId) {
        var flightname = elemVar.value;       
        var resultlist = '';
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.NewBookingExtCC.getFromFlights}',
            flightname, 
            function(result, event){
                
                if (event.status) {                    
                    resultlist = '';
                    for(i=0;i<result.length;i++){
                        resultlist  += '<li class="liItem" id="liItem'+i+'">'+ result[i]+' </li>';
                    }                    
                    if(result.length == 0){
                        hidelistfrom(uniqueId);
                    }else{
                        showlistfrom(elemVar,uniqueId);
                        document.getElementById(uniqueId).innerHTML = resultlist;
                        
                    }
                    
                } else if (event.type === 'exception') {
                    document.getElementById("responseErrorsFrom").innerHTML = 
                        event.message + "<br/>\n<pre>" + event.where + "</pre>";
                } else {
                    document.getElementById("responseErrorsFrom").innerHTML = event.message;
                }
            }, 
            {escape: true}
        );
    }
    function showlistfrom(elem,id){
        $('#'+id).removeClass('slds-lookup__menu');
        document.getElementById(id).addEventListener("click",function(e) {     
            elem.value = e.target.innerText; 
            hidelistfrom(id);
            
        }   );        
    }
    function hidelistfrom(id){
        $('#'+id).addClass('slds-lookup__menu');
        
    }
    </script>
    
    <apex:actionStatus id="pageStatus" >
        <apex:facet name="start">
            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.75; z-index: 1000; background-color: black;">
                &nbsp;
            </div>
            <div style="position: fixed; left: 0; top: 0; bottom: 0; right: 0; z-index: 1001; margin: 15% 45%">
                <div class="sk-circle">
                    <div class="sk-circle1 sk-child"></div>
                    <div class="sk-circle2 sk-child"></div>
                    <div class="sk-circle3 sk-child"></div>
                    <div class="sk-circle4 sk-child"></div>
                    <div class="sk-circle5 sk-child"></div>
                    <div class="sk-circle6 sk-child"></div>
                    <div class="sk-circle7 sk-child"></div>
                    <div class="sk-circle8 sk-child"></div>
                    <div class="sk-circle9 sk-child"></div>
                    <div class="sk-circle10 sk-child"></div>
                    <div class="sk-circle11 sk-child"></div>
                    <div class="sk-circle12 sk-child"></div>
                </div>                            
            </div>
        </apex:facet>
    </apex:actionStatus>
    
    
    
    
    <div class="container bookingpage">
        <div class="slds">
            <apex:form id="mainFrm">
                
                <apex:actionFunction name="RenderPbContainer" rerender="pbContainer,msg"/>
                
                <apex:actionFunction name="checkProductBrand" action="{!checkProductBrand}" rerender="pbContainer,msg"  immediate="{!IF(productId != '', false, true)}" status="pageStatus">
                    <apex:param name="pId" assignto="{!productId}" value="" />
                    <apex:param name="pIdUnique" assignto="{!productIdUnique}" value="" />
                </apex:actionFunction>
                
                
                <apex:actionFunction name="DoAddTr" action="{!DoAddTr}" rerender="pbContainer2,panelComp2,msg"  status="pageStatus">
                    <apex:param name="TrRowUniqueId" assignto="{!ActionRowUniqueId}" value="" />
                </apex:actionFunction>
                
                
                <apex:actionFunction name="DoRemoveJS1" action="{!DoRemove}" rerender="pbContainer,msg"
                                     immediate="true">
                    <apex:param name="ActionRowUniqueId" assignto="{!ActionRowUniqueId}" value="" />
                </apex:actionFunction>
                
                <apex:actionFunction name="DoRemoveJS2" action="{!DoRemoveTr}" rerender="pbContainer,msg"
                                     immediate="true">
                    <apex:param name="ActionRowUniqueIdTr" assignto="{!ActionRowUniqueIdTr}" value=""
                                />
                </apex:actionFunction>
                
                
                <apex:actionFunction name="attachQR"  rerender="attachmentModalFields" oncomplete="openModalAtt();">
                    <apex:param assignTo="{!oliRecId}" name="qrCode" value="" />
                    <apex:param assignTo="{!attFileId}" name="fileId" value="" />
                </apex:actionFunction>
                
                
                <apex:actionFunction action="{!saveAll}" name="saveAll" />
                <apex:actionFunction action="{!saveAndPreview}" name="saveAllandPreview" />
                <apex:actionFunction action="{!saveAndAttach}" name="saveAllandAttach" />
                
                
                <div id="lightning" />
                <!-- Booking Information form -->
                <div class="slds-modal__header" style="background-color:#008FCB ">
                    <div style="position:relative;left:19%;text-align:left;">
                        <span class="header-text"><b>New booking for {!Case.Contact.Name}</b></span><br/>
                        <span class="header-sub-text">Case Number: {!Case.CaseNumber}</span>
                    </div>
                </div>
                
                <div class="slds-grid">
                    
                    <div class="slds-col slds-size--1-of-6 side-bar-grey"></div>
                    
                    <div class="slds-col slds-size--4-of-6 padding-3 initial-tab white">
                        <br/>
                        <div style="text-align:right">
                            <!--apex:commandlink action="{!previewPdf}" target="_blank" rendered="{!o.Id != null}" style="margin-right: .25rem">
<apex:commandButton value="Preview PDF" styleClass="slds-button slds-button_brand" immediate="true" /> 
</apex:commandLink-->
                            
                            
                            <apex:commandButton value="Save & Preview" onCLick="saveAllandPreview(); return false;" styleClass="slds-button slds-button_success"
                                                style="color:white" />
                            <apex:commandButton value="Save & Attach" onCLick="saveAllandAttach(); return false;" styleClass="slds-button slds-button_success"
                                                style="color:white" />
                            <apex:commandButton value="Save" onCLick="saveAll(); return false;" styleClass="slds-button slds-button_success"
                                                style="color:white" />
                            <apex:commandButton value="Cancel" action="{!cancel}" styleClass="slds-button slds-button_destructive"
                                                />
                            <!--v1.5 -->
                        </div>
                        <div id="bookingInfoSection">
                            <div class="slds-section slds-is-open">
                                <h3 class="slds-section__title">
                                    <button id="bookingPageSection" type="button" aria-controls="expando-unique-id" aria-expanded="true"
                                            class="slds-button slds-section__title-action selected-option-lineitem"> 
                                        <span title="Section Title">Order Information</span>
                                    </button>
                                </h3>
                            </div>
                            <apex:pageMessages id="msg2"/>
                            <div class="slds-grid slds-wrap">
                                <div class="slds-size_2-of-2 slds-max-small-size_1-of-1"><br/></div>
                                <div class="slds-size_1-of-2 slds-max-small-size_1-of-1">
                                    <div class="slds-form-element left-cell left-cell-label">
                                        <label class="slds-form-element__label">SF Reference Number</label>
                                        <div class="slds-form-element__control">
                                            <apex:outputText value="{!orderNumber}" html-name="cnumber" id="cnumber"
                                                             styleClass="slds-input" />
                                        </div>
                                        
                                    </div>
                                </div>
                                <div class="slds-size_1-of-2 slds-max-small-size_1-of-1">
                                    <div class="slds-form-element right-cell">
                                        <label class="slds-form-element__label">Order Date<abbr class="slds-required" title="required"><b class="bolded-asterisk">*</b></abbr></label>
                                        <div class="slds-form-element__control">
                                            <apex:outputField value="{!o.EffectiveDate}" html-name="odate" id="odate" styleClass="slds-input"
                                                              style="width: 100%;" />
                                        </div>
                                        
                                    </div>
                                </div>
                                <div class="slds-size_1-of-2 slds-max-small-size_1-of-1">
                                    <div class="slds-form-element left-cell">
                                        <label class="slds-form-element__label">Customer Name<abbr class="slds-required" title="required"><b class="bolded-asterisk">*</b></abbr></label>
                                        <div class="slds-form-element__control">
                                            <apex:outputField value="{!o.SFCC_Customer_Name__c}" html-name="cname" id="cname"
                                                              styleClass="slds-input" />
                                        </div>
                                        
                                    </div>
                                </div>
                                <div class="slds-size_1-of-2 slds-max-small-size_1-of-1">
                                    <div class="slds-form-element right-cell right-cell-label">
                                        <label class="slds-form-element__label">Customer Email<abbr class="slds-required" title="required"><b class="bolded-asterisk">*</b></abbr></label>
                                        <div class="slds-form-element__control">
                                            <apex:outputField value="{!o.SFCC_Customer_Email__c}" html-name="cemail" id="cemail"
                                                              styleClass="slds-input" />
                                        </div>
                                        
                                    </div> 
                                </div>
                                <div class="slds-size_1-of-2 slds-max-small-size_1-of-1">
                                    <div class="slds-form-element left-cell">
                                        <label class="slds-form-element__label">Order Status<abbr class="slds-required" title="required"><b class="bolded-asterisk">*</b></abbr></label>
                                        <div class="slds-form-element__control">
                                            <apex:inputField value="{!o.Status__c}" html-name="cstatus" id="cstatus" styleClass="slds-input"
                                                             />
                                        </div> 
                                        
                                    </div>
                                </div>
                                <div class="slds-size_1-of-2 slds-max-small-size_1-of-1">
                                    <div class="slds-form-element right-cell">
                                        <div class="slds-form-element__control"> 
                                            <label class="slds-form-element__label">Booking Reference Number<abbr class="slds-required" title="required"><b class="bolded-asterisk">*</b></abbr></label>
                                            <div class="slds-form-element__control">
                                                <apex:inputField value="{!o.OrderReferenceNumber}" html-name="crefNumbers" id="crefNumbers" styleClass="slds-input"
                                                                 />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--div class="slds-size_1-of-2 slds-max-small-size_1-of-1">
<div class="slds-form-element left-cell">
<label class="slds-form-element__label">Invoice Number</label>
<div class="slds-form-element__control">
<apex:inputField value="{!o.SFCC_Invoice_Number__c}" html-name="cinumber" id="cinumber" styleClass="slds-input"
/>
</div> 

</div>
</div-->
                                <div class="slds-size_2-of-2 slds-max-small-size_1-of-1">
                                    <div class="slds-form-element cell">
                                        <label class="slds-form-element__label">Remarks</label>
                                        <div class="slds-form-element__control">
                                            <apex:inputField value="{!o.Description}" html-name="cdesc" id="cdesc" styleClass="slds-input"
                                                             />
                                        </div>
                                        
                                    </div>
                                </div>
                                <div class="slds-size_1-of-2 slds-max-small-size_1-of-1">
                                    <div class="slds-form-element  left-cell button-container" style="text-align:right">
                                        <apex:outputPanel id="bookingbuttons">
                                        </apex:outputPanel>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-6 side-bar-grey"></div>
                </div>
                
                <!-- ************************************* OLI Section ***********************************************-->
                <!--<apex:form >-->
                
                
                
                
                <!--v1.5 -->
                <apex:outputPanel id="outerOlisSection">
                    <apex:outputPanel id="innerOlisSection">
                        <div class="slds-grid">
                            <div class="slds-col slds-size--1-of-6 side-bar-grey"></div>
                            <div class="slds-col slds-size--4-of-6 padding-3 white">
                                <div id="oliSection">
                                    <div class="slds-section slds-is-open">
                                        <h3 class="slds-section__title">
                                            <button type="button" aria-controls="expando-unique-id" aria-expanded="true" class="slds-button slds-section__title-action selected-option-lineitem">
                                                <span title="Section Title">Order Line Items</span>
                                            </button>
                                        </h3>
                                    </div>
                                    
                                    
                                    
                                    <!--TEST-->
                                    
                                    <apex:pageMessages id="msg"/>
                                    <div>
                                        <apex:outputPanel id="pbContainer">
                                            <div class="slds-grid slds-nowrap">
                                                
                                                <div class="slds-size_1-of-3 slds-max-small-size_1-of-1 padding-3" >
                                                    <div class="slds-form-element">
                                                        <label class="slds-form-element__label">Sub Total</label>
                                                        <div class="slds-form-element__control">
                                                            <apex:outputText value="{!total}" html-name="ctotals" id="ctotals" styleClass="slds-input"
                                                                             />
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                
                                                <div class="slds-size_1-of-3 slds-max-small-size_1-of-1  padding-3">
                                                    <div class="slds-form-element">
                                                        <label class="slds-form-element__label">Order Total Tax<abbr class="slds-required" title="required"><b class="bolded-asterisk">*</b></abbr></label>                                                        
                                                        <div class="slds-form-element__control">
                                                            <apex:inputField value="{!o.SFCC_Order_Total_Tax__c}" html-name="ctotalstax" id="ctotalstax" styleClass="slds-input" onblur="javascript:checkProductBrand('','');"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-size_1-of-3 slds-max-small-size_1-of-1 padding-3">
                                                    <div class="slds-form-element">
                                                        <label class="slds-form-element__label">Order Total</label>
                                                        <div class="slds-form-element__control">
                                                            <apex:outputText value="{!totalGross}" html-name="ctotalsgross" id="ctotalsgross"
                                                                             styleClass="slds-input" />
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            
                                            <apex:outputPanel id="panelComp" rendered="true"> <br/>
                                                <table width="100%" id="mytable" class="slds-table slds-table_cell-buffer slds-table_bordered slds-table--fixed-layout" style="background-color: none !important;">
                                                    
                                                    <thead>
                                                        
                                                        <tr style="border: .5px solid rgb(201, 199, 197)">
                                                            <th colspan="8">
                                                                <div style="text-align:left;padding-left: 60px"> 
                                                                    Action
                                                                </div>
                                                            </th>
                                                            
                                                            
                                                        </tr>
                                                    </thead> 
                                                    
                                                    <script src="{!URLFOR($Resource.DateTimePicker,'jquery.min.js')}"></script>   
                                                    <script src="{!URLFOR($Resource.DateTimePicker,'moment.min.js')}"></script>   
                                                    <script src="{!URLFOR($Resource.DateTimePicker,'bootstrap.min.js')}"></script>   
                                                    <script src="{!URLFOR($Resource.DateTimePicker,'bootstrap-datetimepicker.min.js')}"></script>   
                                                    
                                                    
                                                    
                                                    
                                                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
                                                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.min.css"/>
                                                    <style>
                                                        html {
                                                        font-size: 15px;
                                                        -webkit-tap-highlight-color: rgba(0,0,0,0);
                                                        }
                                                        .input-group {                                                        
                                                        display: block;
                                                        }
                                                        
                                                        
                                                        
                                                    </style>
                                                    <tbody>
                                                        
                                                        <apex:repeat value="{!ObjectList}" var="a" id="travellerComponentRepeatId"> 
                                                            <tr scope="row">
                                                                
                                                                
                                                                <td style="text-align: left;padding-top: 30px;width: 150px;border-top:.5px solid rgb(201, 199, 197);" scope="col" valign="top" colspan="2">
                                                                    
                                                                    <apex:outputLink styleClass="cmdLink;text-align: center;" value="javascript:DoRemoveJS1('{!a.uniqueId}');" ><img alt="" src="{!URLFOR($Resource.eCommerceResourcesDnata, '/PageIcons/deleteRecord.jpg')}" style="height:25px;"/></apex:outputLink>
                                                                    <span style="color: #015BA7;padding-left: 5px;">   | </span>
                                                                    <apex:outputPanel rendered="{!a.isCSD}">
                                                                        <span style="color: #015BA7;padding-right: 5px;"></span>
                                                                        <a onclick="attachQR('{!a.uniqueId}','{!a.att.Id}');" id="{!a.uniqueId}qr"><img alt="" src="{!IF(a.att.Name == '',URLFOR($Resource.eCommerceResourcesDnata, '/PageIcons/qrRed.jpg'),URLFOR($Resource.eCommerceResourcesDnata, '/PageIcons/qrGreen.jpg'))}" style="height:25px;"/></a>
                                                                        <span style="color: #015BA7;padding-left: 5px;">   | </span>
                                                                    </apex:outputPanel>
                                                                    <apex:outputPanel >
                                                                        <apex:outputLink style="color: #015BA7;" styleClass="cmdLink;text-align: center;"
                                                                                         value="javascript:renderTraveller('{!a.uniqueId}','{!a.uniqueId}btn',{!a.ObjectWrapperTrList.size})"><img alt="" src="{!IF(a.ObjectWrapperTrList.size <> 0,URLFOR($Resource.eCommerceResourcesDnata, '/PageIcons/trGreen.png'),URLFOR($Resource.eCommerceResourcesDnata, '/PageIcons/trRed.png'))}" style="height:25px;"/><span id="{!a.uniqueId}btn" style="font-size:10px;position:fixed;">{!a.ObjectWrapperTrList.size}</span></apex:outputLink>
                                                                    </apex:outputPanel>
                                                                    
                                                                </td>
                                                                
                                                                
                                                                
                                                                <td scope="col" colspan="6" style="border-top:.5px solid rgb(201, 199, 197);">
                                                                    <table id="xxx" border="0" >  
                                                                        
                                                                        
                                                                        
                                                                        <apex:repeat value="{!IF(a.objProduct.Brand__c == 'marhaba',$ObjectType.Order_Line_Item__c.FieldSets.marhabaOrderLineitemFieldset,IF(a.objProduct.Brand__c == 'Arabian Adventures',$ObjectType.Order_Line_Item__c.FieldSets.AAOrderLineitemFieldset,IF(a.objProduct.Brand__c == 'City Sightseeing Dubai',$ObjectType.Order_Line_Item__c.FieldSets.CSDOrderLineitemFieldset,$ObjectType.Order_Line_Item__c.FieldSets.OrderLineitemFieldset)))  }" var="cf" id="travellerComponentRepeatId2">
                                                                            
                                                                            <tr style="float: left!important;margin-left:20px;" >
                                                                                
                                                                                <td scope="col"  style="{!IF(cf.FieldPath == 'Add_on_Service__c','width:800px','width:120px')};line-height:340%;margin-bottom: 3px;"> 
                                                                                    
                                                                                    
                                                                                    <!--label class="slds-form-element__label">{!IF(AND(a.objProduct.Brand__c == 'marhaba', cf.Label == 'Service Start Date'),'Flight Date', IF(AND(a.objProduct.Brand__c == 'marhaba', cf.Label == 'Service Start Time'),'Flight Time',cf.Label))}</label-->
                                                                                    <label class="slds-form-element__label">{!cf.Label}</label>
                                                                                    <apex:outputPanel rendered="{!!OR(cf.FieldPath == 'Flight_Origin__c', cf.FieldPath == 'Flight_Destination__c',cf.FieldPath == 'Service_Start_Date__c')}">
                                                                                        <div scope="col" style="width: 120px;">
                                                                                            <!--apex:outputField value="{!a.obj[cf.FieldName]}" rendered="{!!AND(a.IsEditMode,cf.IsEditable)}" /-->
                                                                                            <apex:inputField value="{!a.obj[cf.FieldPath]}" required="{!cf.required}" onchange="javascript:productEval(this.id,'{!a.uniqueId}','{!cf.FieldPath}');"  >
                                                                                                <!--apex:actionSupport event="onchange" reRender="pbContainer" action="{!DoDelete}"/-->
                                                                                            </apex:inputField>
                                                                                        </div>
                                                                                    </apex:outputPanel> 
                                                                                    
                                                                                    
                                                                                    
                                                                                    <!--apex:outputPanel rendered="{!cf.FieldPath == 'Service_Start_Date__c'}">    

<div scope="col" style="width: 140px;">



<div class='input-group date' id='dp{!a.uniqueId}' >
<apex:inputField value="{!a.obj[cf.FieldPath]}" required="{!cf.required}" showDatePicker="false"/>

<span class="input-group-addon" style="padding: 0px 0px; background-color: transparent; border: none;">
<span class="glyphicon glyphicon-calendar" style="top: -30px;left: 60px;"></span>
</span>

</div>

<script type="text/javascript">


//$(function () {
//$('#dp{!a.uniqueId}').datetimepicker({ 
//format: 'DD/MM/YYYY hh:mm A',
//widgetPositioning:{
//horizontal: 'auto',
//vertical: 'top'
//}
//});
//});
</script>

</div>

</apex:outputPanel-->
                                                                                    
                                                                                    <apex:outputPanel rendered="{!cf.FieldPath == 'Service_Start_Date__c'}">    
                                                                                        
                                                                                        <div scope="col" style="width: 140px;">
                                                                                            
                                                                                            
                                                                                            
                                                                                            <div class='input-group date' id='dp{!a.uniqueId}' >
                                                                                                <apex:inputField value="{!a.obj[cf.FieldPath]}" required="{!cf.required}" showDatePicker="true"/>
                                                                                                
                                                                                                
                                                                                                
                                                                                            </div>
                                                                                            
                                                                                            
                                                                                            
                                                                                        </div>
                                                                                        
                                                                                    </apex:outputPanel>
                                                                                    <!--apex:outputPanel rendered="{!OR(cf.FieldPath == 'Service_Start_Time__c',cf.FieldPath == 'Service_End_Time__c')}">  
<div scope="col" style="width: 120px;">

<apex:selectList value="{!a.obj[cf.FieldPath]}" multiselect="false" size="1">
<apex:selectOptions value="{!timeOptions}" />
</apex:selectList>


</div>
</apex:outputPanel-->
                                                                                    
                                                                                    
                                                                                    
                                                                                    <apex:outputPanel rendered="{!OR(cf.FieldPath == 'Flight_Origin__c', cf.FieldPath == 'Flight_Destination__c')}">
                                                                                        <div scope="col" style="width: 120px;">
                                                                                            <apex:inputField value="{!a.obj[cf.FieldPath]}" required="{!cf.required}" onkeyup="javascript:getRemoteFlightsFrom(this,'{!a.uniqueId}{!cf.FieldPath}')"/>
                                                                                            <ul style="positioin:relative;min-height:40px;max-height:250px;overflow-x:hidden;overflow-y:auto;margin-top:0px !important" class="slds-listbox slds-listbox_vertical slds-dropdown slds-dropdown_fluid slds-lookup__menu slds" id="{!a.uniqueId}{!cf.FieldPath}"></ul>
                                                                                            
                                                                                        </div>
                                                                                        
                                                                                    </apex:outputPanel>
                                                                                    
                                                                                    
                                                                                    
                                                                                </td>
                                                                            </tr>
                                                                            
                                                                        </apex:repeat>
                                                                    </table>
                                                                </td>
                                                                
                                                            </tr>
                                                            <tr scope="row">
                                                                <td colspan="8" id="{!a.uniqueId}" style="display: none;padding-left: 0px;padding-right: 0px;margin-bottom: 5px;background-color:#f0f7f6;">
                                                                    <apex:outputPanel id="pbContainer2">
                                                                        
                                                                        
                                                                        <apex:actionStatus id="ButtonStatus2">
                                                                            <apex:facet name="stop">
                                                                                <apex:outputPanel id="buttonPanel2" rendered="true">
                                                                                    
                                                                                    
                                                                                    <apex:outputLink style="float:right;background-color:#69c7e0" styleClass="slds-button slds-button_brand"
                                                                                                     value="javascript:DoAddTr('{!a.uniqueId}');">Add
                                                                                        Traveller
                                                                                    </apex:outputLink>
                                                                                    
                                                                                </apex:outputPanel> 
                                                                                
                                                                            </apex:facet>
                                                                            <apex:facet name="start">
                                                                                <apex:outputPanel >
                                                                                    <apex:commandButton value="Processing..." disabled="true" style="float:right;" styleClass="slds-button slds-button_brand"
                                                                                                        />
                                                                                </apex:outputPanel>
                                                                            </apex:facet>
                                                                        </apex:actionStatus>
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        <apex:outputPanel id="panelComp2" rendered="true">
                                                                            <table width="100%" id="mytable" class="slds-table slds-table_cell-buffer slds-table_bordered slds-table--fixed-layout">
                                                                                <tr style="border: .5px solid rgb(201, 199, 197);">
                                                                                    <th style="text-align:center;width: 65px">
                                                                                        <div  class="slds-form-element__label">
                                                                                            Action
                                                                                        </div>
                                                                                    </th>
                                                                                    
                                                                                    <apex:repeat value="{!IF(a.objProduct.Brand__c == 'marhaba',$ObjectType.Order_Traveller__c.FieldSets.OT_Fieldset_marhaba,$ObjectType.Order_Traveller__c.FieldSets.OT_Fieldset_AA_CSD)}" var="ff">
                                                                                        
                                                                                        <!--apex:outputPanel rendered="{!OR(ff.Label == 'First Name', ff.Label == 'Last Name')}"-->
                                                                                        <th style="text-align:left;">
                                                                                            <div  class="slds-form-element__label">
                                                                                                {!ff.Label}
                                                                                            </div>
                                                                                        </th>
                                                                                        
                                                                                        <!--apex:outputPanel rendered="{!AND(ff.Label == 'Age Category', a.objProduct.Brand__c == 'marhaba')}"-->
                                                                                        
                                                                                        
                                                                                    </apex:repeat>
                                                                                    
                                                                                </tr>
                                                                                <apex:repeat value="{!a.ObjectWrapperTrList}" var="aa" id="travellerObjectRepeatId">
                                                                                    <tr>
                                                                                        <td style="text-align: center;">
                                                                                            
                                                                                            <apex:outputLink styleClass="cmdLink;text-align: center;" value="javascript:DoRemoveJS2('{!aa.uniqueIdTr}');" ><img alt="" src="{!URLFOR($Resource.eCommerceResourcesDnata, '/PageIcons/deleteRecord.jpg')}" style="height:15px;"/></apex:outputLink>
                                                                                            
                                                                                            <!--apex:outputLink style="background:#c23934;color:white;padding-left:9px;padding-right:9px;position:relative;border-radius:5px" styleClass="cmdLink;text-align: center;" value="javascript:DoRemoveJS2('{!aa.uniqueIdTr}');">X</apex:outputLink-->
                                                                                            
                                                                                            
                                                                                        </td>
                                                                                        
                                                                                        <apex:repeat value="{!IF(a.objProduct.Brand__c == 'marhaba',$ObjectType.Order_Traveller__c.FieldSets.OT_Fieldset_marhaba,$ObjectType.Order_Traveller__c.FieldSets.OT_Fieldset_AA_CSD)}" var="cf"> 
                                                                                            <td>
                                                                                                <apex:facet name="header">
                                                                                                    <span>{!cf.FieldPath}</span>
                                                                                                </apex:facet>
                                                                                                <apex:inputField value="{!aa.objTr[cf.FieldPath]}" required="{!cf.required}"/> 
                                                                                            </td>
                                                                                            
                                                                                            <!--apex:outputPanel rendered="{!AND(cf.FieldPath == 'Org_Age_Category__c', a.objProduct.Brand__c == 'marhaba')}"-->
                                                                                            
                                                                                            
                                                                                            <!--apex:outputPanel rendered="{!AND(cf.FieldPath == 'Org_Age__c', a.objProduct.Brand__c != 'marhaba')}"-->
                                                                                        </apex:repeat> 
                                                                                        
                                                                                    </tr>
                                                                                </apex:repeat>
                                                                            </table>
                                                                        </apex:outputPanel>
                                                                    </apex:outputPanel>
                                                                    
                                                                </td>
                                                            </tr>
                                                            
                                                        </apex:repeat>
                                                    </tbody>
                                                </table>
                                                
                                            </apex:outputPanel>
                                            <br/>
                                            <apex:actionStatus id="ButtonStatus">
                                                <apex:facet name="stop">
                                                    <apex:outputPanel id="buttonPanel" rendered="true">
                                                        <!--apex:commandButton rerender="pbContainer" status="pageStatus" value="View Report" action="{!showRPanel}" immediate="true"/-->
                                                        <!--apex:commandButton value="Back" action="{!refresh}" onComplete="return false;" immediate="true" status="pageStatus"/-->
                                                        <apex:commandButton rerender="msg,msg2,tb" status="pageStatus" value="Add Product"
                                                                            action="{!DoAdd}" 
                                                                            id="componentBtnAdd1" style="float:right;"
                                                                            styleClass="slds-button slds-button_brand"
                                                                            oncomplete="javascript:checkProductBrand('','');"
                                                                            />
                                                        
                                                        
                                                    </apex:outputPanel>
                                                    
                                                </apex:facet>
                                                <apex:facet name="start">
                                                    <apex:outputPanel >
                                                        <apex:commandButton value="Processing..." disabled="true" style="float:right;" styleClass="slds-button slds-button_brand"
                                                                            />
                                                    </apex:outputPanel>
                                                </apex:facet>
                                            </apex:actionStatus>
                                        </apex:outputPanel>
                                        
                                    </div>
                                    
                                    
                                    
                                    
                                    
                                    
                                    <!--END-->
                                    
                                    
                                    
                                    
                                </div>
                                <br/><br/>
                                <hr style="margin:20px 0px;background-color:#dcd9d9" />
                                
                                <div style="text-align:right">
                                    <apex:inputField value="{!o.Name}" styleClass="slds-input" id="seconddnatano2" html-name="seconddnatano"
                                                     required="false" style="position:absolute;visibility:hidden;"
                                                     />
                                    <apex:commandButton value="Save & Preview" onCLick="saveAllandPreview(); return false;" styleClass="slds-button slds-button_success"
                                                        style="color:white" />
                                    <apex:commandButton value="Save & Attach" onCLick="saveAllandAttach(); return false;" styleClass="slds-button slds-button_success"
                                                        style="color:white" />
                                    <apex:commandButton value="Save" onCLick="saveAll(); return false;" styleClass="slds-button slds-button_success"
                                                        style="color:white" />
                                    <apex:commandButton value="Cancel" action="{!cancel}" styleClass="slds-button slds-button_destructive"
                                                        />
                                    <!--v1.5 -->
                                </div>
                            </div>
                            
                            
                            
                            
                        </div>
                    </apex:outputPanel>
                </apex:outputPanel>
                <!-- ************************************* END OLI Section ***********************************************-->
                
                
                
                
                
            </apex:form>
            
            
            
        </div>
        
        
        
        
        
        
        <!-- ************************************* Attachment Modal  *****************************************-->
        
        <apex:form enctype="multipart/form-data" id="attachmentModalForm">
            <div class="demo-only" style="height: 640px;">
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                         aria-describedby="modal-content-id-1" id="attachmentModal" class="slds-modal ">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header">
                            <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Upload QR Code</h2>
                        </header>
                        <apex:outputPanel id="attachmentModalFields">
                            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-size_2-of-2 slds-max-small-size_1-of-1">
                                        <div class="slds-form-element right-cell">
                                            <div class="slds-form-element__control">
                                                <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">
                                                function filechange(e) {
                                                    var fileName = e.target
                                                    .files[0].name;
                                                    var reader = new FileReader();
                                                    reader.onload =
                                                        function(e) {
                                                        $('#blah2').attr(
                                                            'src',
                                                            e.target
                                                            .result
                                                            
                                                        );
                                                        //document.getElementById('tempFileStorage').value = (e.target.result).toString();
                                                        //alert((e.target.result).toString());
                                                        //storeTempFile((e.target.result).toString());
                                                        //console.log(document.getElementById('tempFileStorage'));
                                                        
                                                        //storeTempFile((e.target.result).toString());
                                                        
                                                        //console.log('@@@@@@@@@@' + (e.target.result).toString());
                                                        
                                                    }
                                                    reader.readAsDataURL(e.target.files[0]);
                                                    
                                                    
                                                }
                                                </script>
                                                
                                                
                                                <form runat="server">
                                                    
                                                    <img id="blah2" src="{!IF(attFileId == '',tempFile,'/servlet/servlet.FileDownload?file='+ attFileId +'&operationContext=S1')}" alt="Upload QR Code" style="max-width:50%;max-height:50%;"/>
                                                    <apex:inputFile value="{!fileBody}" filename="{!fileName}" id="file" onchange="filechange(event);" />
                                                    
                                                </form>
                                                
                                                
                                                
                                            </div>
                                        </div>
                                        
                                    </div>
                                    
                                    
                                </div>
                            </div>
                        </apex:outputPanel>
                        <footer class="slds-modal__footer slds-modal__footer_directional">
                            <apex:commandButton immediate="true" styleClass="slds-button slds-button_neutral" value="Cancel" onClick="removeModalAtt();return false;"/>
                            <apex:commandButton styleClass="slds-button slds-button_brand" value="Upload" action="{!UploadFile}" onClick="removeModalAtt();"/>
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop " id="attachmentModalBackdrop"></div>
            </div>
        </apex:form>
        
        
        
        
        <apex:includescript value="//code.jquery.com/jquery-1.11.1.min.js"></apex:includescript>
        <script>
        
        
        
        j$ = jQuery.noConflict();
        j$(document).ready(function() {
            j$('[id$="firstdnatano"]').keyup(function() {
                var bla = j$('[id$="firstdnatano"]').val();
                j$('[id$="seconddnatano"]').val(bla); 
            });
        });
        
        
        </script>
    </div>
    
</apex:page>